<!DOCTYPE html>
<html>
  <head>
    <title>Java clean code – Your Name – Web Developer from Somewhere</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="好代码--可以让人用更少的时间去理解ta。" />
    <meta property="og:description" content="好代码--可以让人用更少的时间去理解ta。" />
    
    <meta name="author" content="Your Name" />

    
    <meta property="og:title" content="Java clean code" />
    <meta property="twitter:title" content="Java clean code" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Your Name - Web Developer from Somewhere" href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="https://raw.githubusercontent.com/barryclark/jekyll-now/master/images/jekyll-logo.png" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Your Name</a></h1>
            <p class="site-description">Web Developer from Somewhere</p>
          </div>

          <nav>
            <a href="/">Blog</a>
            <a href="/about">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <blockquote>
  <p>好代码–可以让人用更少的时间去理解ta。</p>
</blockquote>

<hr />
<p>先来看一段代码，怎么来重构</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Iterator</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReportCard</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">studentName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">cLines</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printReport</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Report card for "</span> <span class="o">+</span> <span class="n">studentName</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"----------------------"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Course Title     Grade"</span><span class="o">);</span>

        <span class="nc">Iterator</span> <span class="n">grades</span> <span class="o">=</span> <span class="n">cLines</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>

        <span class="nc">CourseGrade</span> <span class="n">grade</span><span class="o">;</span>
        <span class="kt">double</span> <span class="n">avg</span> <span class="o">=</span> <span class="mf">0.0</span><span class="o">;</span>

        <span class="k">while</span><span class="o">(</span><span class="n">grades</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
            <span class="n">grade</span> <span class="o">=</span> <span class="o">(</span><span class="nc">CourseGrade</span><span class="o">)</span> <span class="n">grades</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">grade</span><span class="o">.</span><span class="na">title</span> <span class="o">+</span> <span class="s">"    "</span> <span class="o">+</span> <span class="n">grade</span><span class="o">.</span><span class="na">grade</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">grade</span><span class="o">.</span><span class="na">grade</span> <span class="o">==</span> <span class="sc">'F'</span><span class="o">){</span>
                <span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span> <span class="o">+</span> <span class="n">grade</span><span class="o">.</span><span class="na">grade</span> <span class="o">-</span> <span class="mi">64</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span><span class="o">/</span><span class="n">cLines</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"---------------------"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Grade Point Average = "</span> <span class="o">+</span> <span class="n">avg</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">class</span> <span class="nc">CourseGrade</span><span class="o">{</span>
        <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
        <span class="kt">char</span> <span class="n">grade</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>这段代码的主要问题在于</p>
<ol>
  <li>违反单一抽象层次原则 （一个方法中所有操作最好处于同一个层次）：
 作为一个public方法，让人不能第一时间看出来意图。 正确的做法应该是
 printReportHeader（）
 printReportBody（）
 printReportFooter（）
所有操作都是一个抽象层次。</li>
  <li>变量的定义混乱：
变量 avg 在计算过程中 代表 总成绩，也代表平均成绩.
正确的做法是 再定义一个 sum 变量代表 总成绩。</li>
  <li>一个循环做了两件事情：
在一个循环内 既打印report的body，又计算总成绩。这时候我们会纠结
“ 明明可以一次循环弄好的事情，为什么要分成两个循环呢？ 这样性能不好吧。”
多数情况下 多一个循环对性能的影响是很小很小的（可以自己做实验验证）。 ——PS 如果要循环的数据结构很大 很花时间。那就保持一个循环。</li>
  <li>‘F’ 魔法数。 不知道具体含义:
  应该定义一个常量，并以容易理解的单词命名。让他人一眼知道其含义。</li>
</ol>

<p>整理之后的代码为：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Iterator</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReportCard</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">studentName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">cLines</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">char</span> <span class="n">gradeLevel</span> <span class="o">=</span> <span class="sc">'F'</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printReport</span><span class="o">(){</span>
        <span class="n">printHeader</span><span class="o">();</span>

        <span class="n">printReportBody</span><span class="o">();</span>

        <span class="kt">double</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">computeAvg</span><span class="o">();</span>

        <span class="n">printReportFooter</span><span class="o">(</span><span class="n">avg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">printHeader</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Report card for "</span> <span class="o">+</span> <span class="n">studentName</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"----------------------"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Course Title     Grade"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">printReportBody</span><span class="o">(){</span>
        <span class="nc">CourseGrade</span> <span class="n">grade</span><span class="o">;</span>
        <span class="nc">Iterator</span> <span class="n">grades</span> <span class="o">=</span> <span class="n">cLines</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">grades</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
            <span class="n">grade</span> <span class="o">=</span> <span class="o">(</span><span class="nc">CourseGrade</span><span class="o">)</span> <span class="n">grades</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">grade</span><span class="o">.</span><span class="na">title</span> <span class="o">+</span> <span class="s">"    "</span> <span class="o">+</span> <span class="n">grade</span><span class="o">.</span><span class="na">grade</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">printReportFooter</span><span class="o">(</span><span class="kt">double</span> <span class="n">avg</span><span class="o">){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"---------------------"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Grade Point Average = "</span> <span class="o">+</span> <span class="n">avg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">double</span> <span class="nf">computeAvg</span><span class="o">(){</span>
        <span class="nc">Iterator</span> <span class="n">grades</span> <span class="o">=</span> <span class="n">cLines</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>

        <span class="nc">CourseGrade</span> <span class="n">grade</span><span class="o">;</span>
        <span class="kt">double</span> <span class="n">sum</span> <span class="o">=</span> <span class="mf">0.0</span><span class="o">;</span>
        <span class="k">while</span><span class="o">(</span><span class="n">grades</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
            <span class="n">grade</span> <span class="o">=</span> <span class="o">(</span><span class="nc">CourseGrade</span><span class="o">)</span> <span class="n">grades</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">grade</span><span class="o">.</span><span class="na">grade</span> <span class="o">==</span> <span class="n">gradeLevel</span><span class="o">){</span>
                <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">+</span> <span class="n">grade</span><span class="o">.</span><span class="na">grade</span> <span class="o">-</span> <span class="mi">64</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">sum</span><span class="o">/</span><span class="n">cLines</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="kd">class</span> <span class="nc">CourseGrade</span><span class="o">{</span>
        <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
        <span class="kt">char</span> <span class="n">grade</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<hr />

<p>再来看下面的代码</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">String</span> <span class="nf">convert</span><span class="o">(</span><span class="nc">String</span> <span class="n">content</span><span class="o">,</span> <span class="nc">String</span> <span class="n">operationType</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="s">"001"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">operationType</span><span class="o">)){</span>
            <span class="k">return</span> <span class="n">content</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">();</span>
        <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="s">"002"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">operationType</span><span class="o">)){</span>
            <span class="k">return</span>  <span class="n">content</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">();</span>
        <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="s">"003"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">operationType</span><span class="o">)){</span>
            <span class="c1">//do C</span>
        <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="s">"004"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">operationType</span><span class="o">)){</span>
            <span class="c1">//do D</span>
        <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="s">"005"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">operationType</span><span class="o">)){</span>
            <span class="c1">//do E</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>
<p>这段代码的问题是：
臃肿的if-else 结构， 每次增加新功能都要修改这一段代码体。理解起来也复杂。</p>

<p>怎么来重构呢？—- <strong><em>command 模式</em></strong></p>
<ol>
  <li>把每块处理逻辑放到一个简单的“命令”类中，这个类有一个通用的方法。</li>
  <li>用集合来 存储/添加/删除 一批这些命令类的实例. 通过调用他们的执行方法来执行这些实例</li>
</ol>

<p>上代码</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MyConverter</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">convert</span><span class="o">(</span><span class="nc">String</span> <span class="n">content</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ToLowerCaseConverter</span> <span class="kd">implements</span> <span class="nc">MyConverter</span><span class="o">{</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">convert</span><span class="o">(</span><span class="nc">String</span> <span class="n">content</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ToUpperCaseConverter</span> <span class="kd">implements</span> <span class="nc">MyConverter</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">convert</span><span class="o">(</span><span class="nc">String</span> <span class="n">content</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Dispatcher</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">MyConverter</span><span class="o">&gt;</span> <span class="n">handlers</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createHandlers</span><span class="o">(){</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">MyConverter</span><span class="o">&gt;();</span>
        <span class="n">handlers</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"001"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ToLowerCaseConverter</span><span class="o">());</span>
        <span class="n">handlers</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"002"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ToUpperCaseConverter</span><span class="o">());</span>
        <span class="c1">//handlers.put("003", new .....);</span>
        <span class="c1">//handlers.put("004", new .....);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">convert</span><span class="o">(</span><span class="nc">String</span> <span class="n">content</span><span class="o">,</span> <span class="nc">String</span> <span class="n">operationType</span><span class="o">){</span>
        <span class="nc">MyConverter</span> <span class="n">handler</span> <span class="o">=</span> <span class="n">lookupHandlerByType</span><span class="o">(</span><span class="n">operationType</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">handler</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">MyConverter</span> <span class="nf">lookupHandlerByType</span><span class="o">(</span><span class="nc">String</span> <span class="n">type</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">handlers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">Dispatcher</span> <span class="n">dispatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Dispatcher</span><span class="o">();</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="s">"ABC"</span><span class="o">,</span> <span class="s">"001"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="其他需要注意的点">其他需要注意的点</h3>
<ol>
  <li>方法尽量不要传null，也不要返回null。 可以定义NullObject 来代替 null</li>
  <li>判断条件，if (condition) 用肯定句，尽量不要用 if（！condition），便于其他快速理解</li>
  <li>每一行 一个语句</li>
  <li>方法名 和 内容要一致。</li>
</ol>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          



<a href="https://github.com/barryclark/jekyll-now"><i class="svg-icon github"></i></a>




<a href="https://www.twitter.com/jekyllrb"><i class="svg-icon twitter"></i></a>



        </footer>
      </div>
    </div>

    

  </body>
</html>
